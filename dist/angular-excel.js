var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var excel;
(function (excel) {
    Angular.module("angular-excel", [])
        .constant("saveAs", saveAs)
        .constant("XLSX", XLSX)
        .constant("moment", moment)
        .constant("currency", currency)
        .constant("accounting", accounting);
})(excel || (excel = {}));
var CellAddress = (function () {
    function CellAddress(row, col) {
        this.r = row;
        this.c = col;
    }
    return CellAddress;
}());
var CellRange = (function () {
    function CellRange() {
        this.s = new CellAddress(0, 0);
        this.e = new CellAddress(0, 0);
    }
    CellRange.prototype.addAddress = function (address) {
        if (address.r < this.s.r)
            this.s.r = address.r;
        if (address.c < this.s.c)
            this.s.c = address.c;
        if (address.r > this.e.r)
            this.e.r = address.r;
        if (address.c > this.e.c)
            this.e.c = address.c;
    };
    return CellRange;
}());
// see: https://github.com/SheetJS/js-xlsx#cell-object
var Cell = (function () {
    function Cell() {
    }
    Cell.prototype.setValue = function (value, type, format) {
        if (value == null)
            return;
        this.v = value.toString();
        this.t = type;
        this.z = format;
    };
    return Cell;
}());
var DateCell = (function (_super) {
    __extends(DateCell, _super);
    function DateCell(isoDate) {
        var _this = _super.call(this) || this;
        _this.setValue(isoDate, 'd');
        return _this;
    }
    return DateCell;
}(Cell));
var CurrencyCell = (function (_super) {
    __extends(CurrencyCell, _super);
    function CurrencyCell(value, format) {
        if (format === void 0) { format = "$#,##0.00"; }
        var _this = _super.call(this) || this;
        _this.setValue(value, 'n', format);
        return _this;
    }
    return CurrencyCell;
}(Cell));
var TimeCell = (function (_super) {
    __extends(TimeCell, _super);
    function TimeCell(isoTime, format) {
        if (format === void 0) { format = "h:mm AM/PM"; }
        var _this = _super.call(this) || this;
        var value = TimeCell.formatValue(isoTime);
        _this.setValue(value, 'n', format);
        return _this;
    }
    TimeCell.formatValue = function (isoTime) {
        if (isoTime == null)
            return;
        var values = isoTime.split(":");
        var hourSeconds = Number(values[0]) * TimeCell.SECONDS_IN_HOUR;
        var minuteSeconds = Number(values[1]) * TimeCell.SECONDS_IN_MINUTE;
        var seconds = Number(values[2]);
        var totalSeconds = hourSeconds + minuteSeconds + seconds;
        var value = totalSeconds / TimeCell.SECONDS_IN_DAY;
        return value;
    };
    TimeCell.SECONDS_IN_DAY = 86400;
    TimeCell.SECONDS_IN_HOUR = 3600;
    TimeCell.SECONDS_IN_MINUTE = 60;
    return TimeCell;
}(Cell));
var NumberCell = (function (_super) {
    __extends(NumberCell, _super);
    function NumberCell(value) {
        var _this = _super.call(this) || this;
        _this.setValue(value, 'n');
        return _this;
    }
    return NumberCell;
}(Cell));
var StringCell = (function (_super) {
    __extends(StringCell, _super);
    function StringCell(value) {
        var _this = _super.call(this) || this;
        _this.setValue(value, 's');
        return _this;
    }
    return StringCell;
}(Cell));
var WorkSheet = (function () {
    function WorkSheet(name, xlsx) {
        this.name = name;
        this.xlsx = xlsx;
        this._range = new CellRange();
    }
    WorkSheet.prototype.setCell = function (row, col, value, cell) {
        var address = new CellAddress(row, col);
        if (!cell)
            cell = new StringCell(value);
        var cellReference = this.xlsx.utils.encode_cell(address);
        this[cellReference] = cell;
        this._range.addAddress(address);
        this["!ref"] = this.xlsx.utils.encode_range(this._range);
    };
    WorkSheet.prototype.getCell = function (row, col) {
        var address = new CellAddress(row, col);
        var cellReference = this.xlsx.utils.encode_cell(address);
        var cell = this[cellReference];
        return cell;
    };
    return WorkSheet;
}());
var WorkBook = (function () {
    function WorkBook(xlsx) {
        this.xlsx = xlsx;
        this['SheetNames'] = [];
        this['Sheets'] = {};
    }
    WorkBook.prototype.addWorkSheet = function (worksheet) {
        if (typeof worksheet == "string")
            worksheet = new WorkSheet(worksheet, this.xlsx);
        var name = worksheet.name;
        var sheetNames = this['SheetNames'];
        sheetNames.push(name);
        this['Sheets'][name] = worksheet;
        return worksheet;
    };
    return WorkBook;
}());
var WorkSheetBuilder = (function () {
    function WorkSheetBuilder(xlsx, moment, currency, accounting, values) {
        this.xlsx = xlsx;
        this.moment = moment;
        this.currency = currency;
        this.accounting = accounting;
        this.values = values;
        this.columns = [];
    }
    WorkSheetBuilder.prototype.addTimeColumn = function (name, expression, format) {
        this.columns.push({ name: name, expression: expression, createCell: function (x) { return new TimeCell(x, format); } });
        return this;
    };
    WorkSheetBuilder.prototype.addDateColumn = function (name, expression) {
        this.columns.push({
            name: name,
            expression: expression,
            createCell: function (x) { return new DateCell(x); }
        });
        return this;
    };
    WorkSheetBuilder.prototype.addNumberColumn = function (name, expression) {
        this.columns.push({ name: name, expression: expression, createCell: function (x) { return new NumberCell(x); } });
        return this;
    };
    WorkSheetBuilder.prototype.getCurrencyFormat = function (currency) {
        var currencySymbol = this.currency.symbolize(currency);
        var currencySettings = this.accounting.settings.currency;
        var currencyFormat = currencySymbol + "#" + currencySettings.thousand + "##0" + currencySettings.decimal + "00";
        return currencyFormat;
    };
    WorkSheetBuilder.prototype.addCurrencyColumn = function (name, expression, getCurrency) {
        var _this = this;
        this.columns.push({
            name: name, expression: expression, createCell: function (value, x) {
                var format = getCurrency ? _this.getCurrencyFormat(getCurrency(x)) : _this.currencyFormat;
                return new CurrencyCell(value, format);
            }
        });
        return this;
    };
    WorkSheetBuilder.prototype.addColumn = function (name, expression, createCell) {
        this.columns.push({ name: name, expression: expression, createCell: createCell });
        return this;
    };
    WorkSheetBuilder.prototype.setCurrency = function (currency) {
        this.currencyFormat = this.getCurrencyFormat(currency);
        return this;
    };
    WorkSheetBuilder.prototype.setName = function (name) {
        this.name = name;
        return this;
    };
    WorkSheetBuilder.prototype.build = function () {
        var _this = this;
        var worksheet = new WorkSheet(this.name, this.xlsx);
        for (var colIdx = 0; colIdx < this.columns.length; colIdx++) {
            var column = this.columns[colIdx];
            worksheet.setCell(0, colIdx, column.name);
        }
        this.values.forEach(function (x, rowIdx) {
            for (var colIdx = 0; colIdx < _this.columns.length; colIdx++) {
                var column = _this.columns[colIdx];
                var value = column.expression(x);
                var cell = column.createCell ? column.createCell(value, x) : null;
                worksheet.setCell(rowIdx + 1, colIdx, value, cell);
            }
        });
        return worksheet;
    };
    return WorkSheetBuilder;
}());
var ExcelConverter = (function () {
    function ExcelConverter(_saveAs, xlsx, moment, currency, accounting) {
        this._saveAs = _saveAs;
        this.xlsx = xlsx;
        this.moment = moment;
        this.currency = currency;
        this.accounting = accounting;
    }
    ExcelConverter.prototype.create = function () {
        var wb = new WorkBook(this.xlsx);
        return wb;
    };
    ExcelConverter.prototype.createBuilder = function (values) {
        var builder = new WorkSheetBuilder(this.xlsx, this.moment, this.currency, this.accounting, values);
        return builder;
    };
    ExcelConverter.prototype.saveAs = function (name, workbook) {
        var enableLegacySafariSupport = true;
        var wbout = this.xlsx.write(workbook, { bookType: 'xlsx', bookSST: enableLegacySafariSupport, type: 'binary' });
        var buffer = this.convertToBinary(wbout);
        this._saveAs(new Blob([buffer], { type: "application/octet-stream" }), name + ".xlsx");
    };
    ExcelConverter.prototype.convertToBinary = function (workbook) {
        var buffer = new ArrayBuffer(workbook.length);
        var view = new Uint8Array(buffer);
        for (var i = 0; i !== workbook.length; ++i)
            view[i] = workbook.charCodeAt(i) & 0xFF;
        return buffer;
    };
    ExcelConverter.$inject = ['saveAs', 'XLSX', 'moment', 'currency', 'accounting'];
    return ExcelConverter;
}());
Angular.module("angular-excel").service('excelConverter', ExcelConverter);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1leGNlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAudHMiLCIuLi9zcmMvY2VsbEFkZHJlc3MudHMiLCIuLi9zcmMvY2VsbFJhbmdlLnRzIiwiLi4vc3JjL2NlbGwudHMiLCIuLi9zcmMvd29ya3NoZWV0LnRzIiwiLi4vc3JjL3dvcmtib29rLnRzIiwiLi4vc3JjL3dvcmtzaGVldEJ1aWxkZXIudHMiLCIuLi9zcmMvZXhjZWxDb252ZXJ0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLElBQVUsS0FBSyxDQWFkO0FBYkQsV0FBVSxLQUFLO0lBT1gsT0FBTyxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsRUFBRSxDQUFDO1NBQzlCLFFBQVEsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDO1NBQzFCLFFBQVEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDO1NBQ3RCLFFBQVEsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDO1NBQzFCLFFBQVEsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDO1NBQzlCLFFBQVEsQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLENBQUM7QUFDNUMsQ0FBQyxFQWJTLEtBQUssS0FBTCxLQUFLLFFBYWQ7QUNSRDtJQUNJLHFCQUFZLEdBQVcsRUFBRSxHQUFXO1FBQ2hDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQ2IsSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7SUFDakIsQ0FBQztJQU1MLGtCQUFDO0FBQUQsQ0FBQyxBQVZELElBVUM7QUNYRDtJQUNJO1FBQ0ksSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDL0IsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLFdBQVcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQU9ELDhCQUFVLEdBQVYsVUFBVyxPQUFx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WSxDQUFDLENBQUM7SUE4QjVFLHFCQUFDO0NBQUEsQUFoQ0QsSUFnQ0M7QUFFRCxPQUFPLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxjQUFjLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIm5hbWVzcGFjZSBleGNlbCB7XHJcbiAgICBkZWNsYXJlIHZhciBYTFNYOiBhbnk7XHJcbiAgICBkZWNsYXJlIHZhciBzYXZlQXM6IGFueTtcclxuICAgIGRlY2xhcmUgdmFyIG1vbWVudDogYW55O1xyXG4gICAgZGVjbGFyZSB2YXIgY3VycmVuY3k6IGFueTtcclxuICAgIGRlY2xhcmUgdmFyIGFjY291bnRpbmc6IGFueTtcclxuXHJcbiAgICBBbmd1bGFyLm1vZHVsZShcImFuZ3VsYXItZXhjZWxcIiwgW10pXHJcbiAgICAgICAgLmNvbnN0YW50KFwic2F2ZUFzXCIsIHNhdmVBcylcclxuICAgICAgICAuY29uc3RhbnQoXCJYTFNYXCIsIFhMU1gpXHJcbiAgICAgICAgLmNvbnN0YW50KFwibW9tZW50XCIsIG1vbWVudClcclxuICAgICAgICAuY29uc3RhbnQoXCJjdXJyZW5jeVwiLCBjdXJyZW5jeSlcclxuICAgICAgICAuY29uc3RhbnQoXCJhY2NvdW50aW5nXCIsIGFjY291bnRpbmcpO1xyXG59IiwiaW50ZXJmYWNlIElDZWxsQWRkcmVzcyB7XHJcbiAgICBjOiBudW1iZXI7XHJcbiAgICByOiBudW1iZXI7XHJcbn1cclxuXHJcbmNsYXNzIENlbGxBZGRyZXNzIGltcGxlbWVudHMgSUNlbGxBZGRyZXNzIHtcclxuICAgIGNvbnN0cnVjdG9yKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuciA9IHJvdztcclxuICAgICAgICB0aGlzLmMgPSBjb2w7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMC1pbmRleGVkIGNvbHVtblxyXG4gICAgYzogbnVtYmVyO1xyXG4gICAgLy8gMC1pbmRleGVkIHJvd1xyXG4gICAgcjogbnVtYmVyO1xyXG59IiwiaW50ZXJmYWNlIElDZWxsUmFuZ2Uge1xyXG4gICAgYWRkQWRkcmVzcyhhZGRyZXNzOiBJQ2VsbEFkZHJlc3MpO1xyXG59XHJcblxyXG5jbGFzcyBDZWxsUmFuZ2UgaW1wbGVtZW50cyBJQ2VsbFJhbmdlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMucyA9IG5ldyBDZWxsQWRkcmVzcygwLCAwKTtcclxuICAgICAgICB0aGlzLmUgPSBuZXcgQ2VsbEFkZHJlc3MoMCwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gc3RhcnRcclxuICAgIHM6IENlbGxBZGRyZXNzO1xyXG4gICAgLy8gZW5kXHJcbiAgICBlOiBDZWxsQWRkcmVzcztcclxuXHJcbiAgICBhZGRBZGRyZXNzKGFkZHJlc3M6IElDZWxsQWRkcmVzcykge1xyXG4gICAgICAgIGlmIChhZGRyZXNzLnIgPCB0aGlzLnMucilcclxuICAgICAgICAgICAgdGhpcy5zLnIgPSBhZGRyZXNzLnI7XHJcbiAgICAgICAgaWYgKGFkZHJlc3MuYyA8IHRoaXMucy5jKVxyXG4gICAgICAgICAgICB0aGlzLnMuYyA9IGFkZHJlc3MuYztcclxuXHJcbiAgICAgICAgaWYgKGFkZHJlc3MuciA+IHRoaXMuZS5yKVxyXG4gICAgICAgICAgICB0aGlzLmUuciA9IGFkZHJlc3MucjtcclxuICAgICAgICBpZiAoYWRkcmVzcy5jID4gdGhpcy5lLmMpXHJcbiAgICAgICAgICAgIHRoaXMuZS5jID0gYWRkcmVzcy5jO1xyXG4gICAgfVxyXG59IiwiLy8gc2VlOiBodHRwczovL2dpdGh1Yi5jb20vU2hlZXRKUy9qcy14bHN4I2NlbGwtb2JqZWN0XHJcblxyXG5pbnRlcmZhY2UgSUNlbGwge1xyXG4gICAgdjogc3RyaW5nO1xyXG4gICAgdzogc3RyaW5nO1xyXG4gICAgdDogc3RyaW5nO1xyXG4gICAgZjogc3RyaW5nO1xyXG4gICAgRjogc3RyaW5nO1xyXG4gICAgcjogc3RyaW5nO1xyXG4gICAgaDogc3RyaW5nO1xyXG4gICAgYzogc3RyaW5nO1xyXG4gICAgejogc3RyaW5nO1xyXG4gICAgbDogc3RyaW5nO1xyXG4gICAgczogc3RyaW5nO1xyXG59XHJcblxyXG5jbGFzcyBDZWxsIGltcGxlbWVudHMgSUNlbGwge1xyXG4gICAgcHJvdGVjdGVkIHNldFZhbHVlKHZhbHVlOiBhbnksIHR5cGU6IHN0cmluZywgZm9ybWF0Pzogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB0aGlzLnYgPSB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIHRoaXMudCA9IHR5cGU7XHJcbiAgICAgICAgdGhpcy56ID0gZm9ybWF0O1xyXG4gICAgfVxyXG5cclxuICAgIHY6IHN0cmluZztcclxuICAgIHc6IHN0cmluZztcclxuICAgIHQ6IHN0cmluZztcclxuICAgIGY6IHN0cmluZztcclxuICAgIEY6IHN0cmluZztcclxuICAgIHI6IHN0cmluZztcclxuICAgIGg6IHN0cmluZztcclxuICAgIGM6IHN0cmluZztcclxuICAgIHo6IHN0cmluZztcclxuICAgIGw6IHN0cmluZztcclxuICAgIHM6IHN0cmluZztcclxufVxyXG5cclxuY2xhc3MgRGF0ZUNlbGwgZXh0ZW5kcyBDZWxsIHtcclxuICAgIGNvbnN0cnVjdG9yKGlzb0RhdGU6IHN0cmluZykge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZShpc29EYXRlLCAnZCcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBDdXJyZW5jeUNlbGwgZXh0ZW5kcyBDZWxsIHtcclxuICAgIGNvbnN0cnVjdG9yKHZhbHVlOiBzdHJpbmcsIGZvcm1hdDogc3RyaW5nID0gXCIkIywjIzAuMDBcIikge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSwgJ24nLCBmb3JtYXQpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBUaW1lQ2VsbCBleHRlbmRzIENlbGwge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgU0VDT05EU19JTl9EQVkgPSA4NjQwMDtcclxuICAgIHByaXZhdGUgc3RhdGljIFNFQ09ORFNfSU5fSE9VUiA9IDM2MDA7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBTRUNPTkRTX0lOX01JTlVURSA9IDYwO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGlzb1RpbWU6IHN0cmluZywgZm9ybWF0OiBzdHJpbmcgPSBcImg6bW0gQU0vUE1cIikge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBUaW1lQ2VsbC5mb3JtYXRWYWx1ZShpc29UaW1lKTtcclxuICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlLCAnbicsIGZvcm1hdCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgZm9ybWF0VmFsdWUoaXNvVGltZTogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKGlzb1RpbWUgPT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICBjb25zdCB2YWx1ZXMgPSBpc29UaW1lLnNwbGl0KFwiOlwiKTtcclxuICAgICAgICBjb25zdCBob3VyU2Vjb25kcyA9IE51bWJlcih2YWx1ZXNbMF0pICogVGltZUNlbGwuU0VDT05EU19JTl9IT1VSO1xyXG4gICAgICAgIGNvbnN0IG1pbnV0ZVNlY29uZHMgPSBOdW1iZXIodmFsdWVzWzFdKSAqIFRpbWVDZWxsLlNFQ09ORFNfSU5fTUlOVVRFO1xyXG4gICAgICAgIGNvbnN0IHNlY29uZHMgPSBOdW1iZXIodmFsdWVzWzJdKTtcclxuICAgICAgICBjb25zdCB0b3RhbFNlY29uZHMgPSBob3VyU2Vjb25kcyArIG1pbnV0ZVNlY29uZHMgKyBzZWNvbmRzO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gdG90YWxTZWNvbmRzIC8gVGltZUNlbGwuU0VDT05EU19JTl9EQVk7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBOdW1iZXJDZWxsIGV4dGVuZHMgQ2VsbCB7XHJcbiAgICBjb25zdHJ1Y3Rvcih2YWx1ZT86IGFueSkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSwgJ24nKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgU3RyaW5nQ2VsbCBleHRlbmRzIENlbGwge1xyXG4gICAgY29uc3RydWN0b3IodmFsdWU/OiBhbnkpIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUsICdzJyk7XHJcbiAgICB9XHJcbn0iLCJpbnRlcmZhY2UgSVdvcmtTaGVldCB7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBzZXRDZWxsKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgdmFsdWU6IGFueSwgY2VsbD86IElDZWxsKTtcclxuICAgIGdldENlbGwocm93OiBudW1iZXIsIGNvbDogbnVtYmVyKTogSUNlbGw7XHJcbn1cclxuXHJcbmNsYXNzIFdvcmtTaGVldCBpbXBsZW1lbnRzIElXb3JrU2hlZXQge1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIG5hbWUsIHByaXZhdGUgeGxzeDogYW55KSB7XHJcbiAgICAgICAgdGhpcy5fcmFuZ2UgPSBuZXcgQ2VsbFJhbmdlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfcmFuZ2U6IElDZWxsUmFuZ2U7XHJcblxyXG4gICAgc2V0Q2VsbChyb3c6IG51bWJlciwgY29sOiBudW1iZXIsIHZhbHVlOiBhbnksIGNlbGw/OiBJQ2VsbCkge1xyXG4gICAgICAgIHZhciBhZGRyZXNzID0gbmV3IENlbGxBZGRyZXNzKHJvdywgY29sKTtcclxuICAgICAgICBpZiAoIWNlbGwpXHJcbiAgICAgICAgICAgIGNlbGwgPSBuZXcgU3RyaW5nQ2VsbCh2YWx1ZSk7XHJcblxyXG4gICAgICAgIHZhciBjZWxsUmVmZXJlbmNlID0gdGhpcy54bHN4LnV0aWxzLmVuY29kZV9jZWxsKGFkZHJlc3MpO1xyXG4gICAgICAgIHRoaXNbY2VsbFJlZmVyZW5jZV0gPSBjZWxsO1xyXG5cclxuICAgICAgICB0aGlzLl9yYW5nZS5hZGRBZGRyZXNzKGFkZHJlc3MpO1xyXG4gICAgICAgIHRoaXNbXCIhcmVmXCJdID0gdGhpcy54bHN4LnV0aWxzLmVuY29kZV9yYW5nZSh0aGlzLl9yYW5nZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2VsbChyb3c6IG51bWJlciwgY29sOiBudW1iZXIpOiBJQ2VsbCB7XHJcbiAgICAgICAgdmFyIGFkZHJlc3MgPSBuZXcgQ2VsbEFkZHJlc3Mocm93LCBjb2wpO1xyXG4gICAgICAgIHZhciBjZWxsUmVmZXJlbmNlID0gdGhpcy54bHN4LnV0aWxzLmVuY29kZV9jZWxsKGFkZHJlc3MpO1xyXG4gICAgICAgIHZhciBjZWxsID0gdGhpc1tjZWxsUmVmZXJlbmNlXTtcclxuICAgICAgICByZXR1cm4gY2VsbDtcclxuICAgIH1cclxufSIsImludGVyZmFjZSBJV29ya0Jvb2sge1xyXG4gICAgYWRkV29ya1NoZWV0KHdzOiBzdHJpbmcgfCBJV29ya1NoZWV0KTogSVdvcmtTaGVldDtcclxuXHJcbn1cclxuXHJcbmNsYXNzIFdvcmtCb29rIGltcGxlbWVudHMgSVdvcmtCb29rIHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgeGxzeDogYW55KSB7XHJcbiAgICAgICAgdGhpc1snU2hlZXROYW1lcyddID0gW107XHJcbiAgICAgICAgdGhpc1snU2hlZXRzJ10gPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRXb3JrU2hlZXQod29ya3NoZWV0OiBzdHJpbmcgfCBJV29ya1NoZWV0KTogSVdvcmtTaGVldCB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB3b3Jrc2hlZXQgPT0gXCJzdHJpbmdcIilcclxuICAgICAgICAgICAgd29ya3NoZWV0ID0gbmV3IFdvcmtTaGVldCh3b3Jrc2hlZXQsIHRoaXMueGxzeCk7XHJcblxyXG4gICAgICAgIGNvbnN0IG5hbWUgPSB3b3Jrc2hlZXQubmFtZTtcclxuICAgICAgICBsZXQgc2hlZXROYW1lczogc3RyaW5nW10gPSB0aGlzWydTaGVldE5hbWVzJ107XHJcbiAgICAgICAgc2hlZXROYW1lcy5wdXNoKG5hbWUpO1xyXG4gICAgICAgIHRoaXNbJ1NoZWV0cyddW25hbWVdID0gd29ya3NoZWV0O1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB3b3Jrc2hlZXQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2hlZXROYW1lczogc3RyaW5nW107XHJcbiAgICBwcml2YXRlIF9zaGVldHM6IHN0cmluZ1tdW107XHJcbn0iLCJpbnRlcmZhY2UgSVdvcmtTaGVldEJ1aWxkZXI8VD4ge1xyXG4gICAgYWRkVGltZUNvbHVtbihuYW1lOiBzdHJpbmcsIGV4cHJlc3Npb246ICh4OiBUKSA9PiBhbnksIGZvcm1hdD86IHN0cmluZyk6IElXb3JrU2hlZXRCdWlsZGVyPFQ+XHJcbiAgICBhZGREYXRlQ29sdW1uKG5hbWU6IHN0cmluZywgZXhwcmVzc2lvbjogKHg6IFQpID0+IGFueSk6IElXb3JrU2hlZXRCdWlsZGVyPFQ+O1xyXG4gICAgYWRkTnVtYmVyQ29sdW1uKG5hbWU6IHN0cmluZywgZXhwcmVzc2lvbjogKHg6IFQpID0+IGFueSk6IElXb3JrU2hlZXRCdWlsZGVyPFQ+XHJcbiAgICBhZGRDdXJyZW5jeUNvbHVtbihuYW1lOiBzdHJpbmcsIGV4cHJlc3Npb246ICh4OiBUKSA9PiBhbnksIGdldEN1cnJlbmN5PzogKHg6IFQpID0+IHN0cmluZyk6IElXb3JrU2hlZXRCdWlsZGVyPFQ+XHJcbiAgICBhZGRDb2x1bW4obmFtZTogc3RyaW5nLCBleHByZXNzaW9uOiAoeDogVCkgPT4gYW55LCBjcmVhdGVDZWxsPzogKHg6IGFueSkgPT4gSUNlbGwpOiBJV29ya1NoZWV0QnVpbGRlcjxUPjtcclxuICAgIHNldE5hbWUobmFtZTogc3RyaW5nKTogSVdvcmtTaGVldEJ1aWxkZXI8VD47XHJcbiAgICBzZXRDdXJyZW5jeShjdXJyZW5jeUZvcm1hdDogc3RyaW5nKTogSVdvcmtTaGVldEJ1aWxkZXI8VD47XHJcbiAgICBidWlsZCgpOiBJV29ya1NoZWV0O1xyXG59XHJcblxyXG5jbGFzcyBXb3JrU2hlZXRCdWlsZGVyPFQ+IGltcGxlbWVudHMgSVdvcmtTaGVldEJ1aWxkZXI8VD4ge1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSB4bHN4OiBhbnksXHJcbiAgICAgICAgcHJpdmF0ZSBtb21lbnQ6IGFueSxcclxuICAgICAgICBwcml2YXRlIGN1cnJlbmN5OiBhbnksXHJcbiAgICAgICAgcHJpdmF0ZSBhY2NvdW50aW5nOiBhbnksXHJcbiAgICAgICAgcHJpdmF0ZSB2YWx1ZXM6IFRbXVxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5jb2x1bW5zID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgYWRkVGltZUNvbHVtbihuYW1lOiBzdHJpbmcsIGV4cHJlc3Npb246ICh4OiBUKSA9PiBhbnksIGZvcm1hdD86IHN0cmluZyk6IElXb3JrU2hlZXRCdWlsZGVyPFQ+IHtcclxuICAgICAgICB0aGlzLmNvbHVtbnMucHVzaCh7IG5hbWU6IG5hbWUsIGV4cHJlc3Npb246IGV4cHJlc3Npb24sIGNyZWF0ZUNlbGw6IHggPT4gbmV3IFRpbWVDZWxsKHgsIGZvcm1hdCkgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkRGF0ZUNvbHVtbihuYW1lOiBzdHJpbmcsIGV4cHJlc3Npb246ICh4OiBUKSA9PiBhbnkpOiBJV29ya1NoZWV0QnVpbGRlcjxUPiB7XHJcbiAgICAgICAgdGhpcy5jb2x1bW5zLnB1c2goe1xyXG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxyXG4gICAgICAgICAgICBleHByZXNzaW9uOiBleHByZXNzaW9uLFxyXG4gICAgICAgICAgICBjcmVhdGVDZWxsOiB4ID0+IG5ldyBEYXRlQ2VsbCh4KVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZE51bWJlckNvbHVtbihuYW1lOiBzdHJpbmcsIGV4cHJlc3Npb246ICh4OiBUKSA9PiBhbnkpOiBJV29ya1NoZWV0QnVpbGRlcjxUPiB7XHJcbiAgICAgICAgdGhpcy5jb2x1bW5zLnB1c2goeyBuYW1lOiBuYW1lLCBleHByZXNzaW9uOiBleHByZXNzaW9uLCBjcmVhdGVDZWxsOiB4ID0+IG5ldyBOdW1iZXJDZWxsKHgpIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Q3VycmVuY3lGb3JtYXQoY3VycmVuY3k6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgY3VycmVuY3lTeW1ib2wgPSB0aGlzLmN1cnJlbmN5LnN5bWJvbGl6ZShjdXJyZW5jeSk7XHJcbiAgICAgICAgY29uc3QgY3VycmVuY3lTZXR0aW5ncyA9IHRoaXMuYWNjb3VudGluZy5zZXR0aW5ncy5jdXJyZW5jeTtcclxuICAgICAgICB2YXIgY3VycmVuY3lGb3JtYXQgPSBgJHtjdXJyZW5jeVN5bWJvbH0jJHtjdXJyZW5jeVNldHRpbmdzLnRob3VzYW5kfSMjMCR7Y3VycmVuY3lTZXR0aW5ncy5kZWNpbWFsfTAwYDtcclxuICAgICAgICByZXR1cm4gY3VycmVuY3lGb3JtYXQ7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkQ3VycmVuY3lDb2x1bW4obmFtZTogc3RyaW5nLCBleHByZXNzaW9uOiAoeDogVCkgPT4gYW55LCBnZXRDdXJyZW5jeT86ICh4OiBUKSA9PiBzdHJpbmcpOiBJV29ya1NoZWV0QnVpbGRlcjxUPiB7XHJcbiAgICAgICAgdGhpcy5jb2x1bW5zLnB1c2goe1xyXG4gICAgICAgICAgICBuYW1lOiBuYW1lLCBleHByZXNzaW9uOiBleHByZXNzaW9uLCBjcmVhdGVDZWxsOiAodmFsdWUsIHgpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBmb3JtYXQgPSBnZXRDdXJyZW5jeSA/IHRoaXMuZ2V0Q3VycmVuY3lGb3JtYXQoZ2V0Q3VycmVuY3koeCkpIDogdGhpcy5jdXJyZW5jeUZvcm1hdDtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ3VycmVuY3lDZWxsKHZhbHVlLCBmb3JtYXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkQ29sdW1uKG5hbWU6IHN0cmluZywgZXhwcmVzc2lvbjogKHg6IFQpID0+IGFueSwgY3JlYXRlQ2VsbD86ICh4OiBhbnkpID0+IElDZWxsKTogSVdvcmtTaGVldEJ1aWxkZXI8VD4ge1xyXG4gICAgICAgIHRoaXMuY29sdW1ucy5wdXNoKHsgbmFtZTogbmFtZSwgZXhwcmVzc2lvbjogZXhwcmVzc2lvbiwgY3JlYXRlQ2VsbDogY3JlYXRlQ2VsbCB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBzZXRDdXJyZW5jeShjdXJyZW5jeTogc3RyaW5nKTogSVdvcmtTaGVldEJ1aWxkZXI8VD4ge1xyXG4gICAgICAgIHRoaXMuY3VycmVuY3lGb3JtYXQgPSB0aGlzLmdldEN1cnJlbmN5Rm9ybWF0KGN1cnJlbmN5KVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldE5hbWUobmFtZTogc3RyaW5nKTogSVdvcmtTaGVldEJ1aWxkZXI8VD4ge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgYnVpbGQoKTogSVdvcmtTaGVldCB7XHJcbiAgICAgICAgdmFyIHdvcmtzaGVldCA9IG5ldyBXb3JrU2hlZXQodGhpcy5uYW1lLCB0aGlzLnhsc3gpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBjb2xJZHggPSAwOyBjb2xJZHggPCB0aGlzLmNvbHVtbnMubGVuZ3RoOyBjb2xJZHgrKykge1xyXG4gICAgICAgICAgICBsZXQgY29sdW1uID0gdGhpcy5jb2x1bW5zW2NvbElkeF07XHJcbiAgICAgICAgICAgIHdvcmtzaGVldC5zZXRDZWxsKDAsIGNvbElkeCwgY29sdW1uLm5hbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy52YWx1ZXMuZm9yRWFjaCgoeCwgcm93SWR4KSA9PiB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGNvbElkeCA9IDA7IGNvbElkeCA8IHRoaXMuY29sdW1ucy5sZW5ndGg7IGNvbElkeCsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1uID0gdGhpcy5jb2x1bW5zW2NvbElkeF07XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbHVtbi5leHByZXNzaW9uKHgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGNvbHVtbi5jcmVhdGVDZWxsID8gY29sdW1uLmNyZWF0ZUNlbGwodmFsdWUsIHgpIDogbnVsbDtcclxuICAgICAgICAgICAgICAgIHdvcmtzaGVldC5zZXRDZWxsKHJvd0lkeCArIDEsIGNvbElkeCwgdmFsdWUsIGNlbGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB3b3Jrc2hlZXQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBuYW1lOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGN1cnJlbmN5Rm9ybWF0OiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGNvbHVtbnM6IHsgbmFtZTogc3RyaW5nLCBleHByZXNzaW9uOiAoeDogVCkgPT4gYW55LCBjcmVhdGVDZWxsPzogKHZhbHVlOiBhbnksIHg6IFQpID0+IElDZWxsIH1bXTtcclxufSIsImludGVyZmFjZSBJRXhjZWxDb252ZXJ0ZXIge1xyXG4gICAgY3JlYXRlKCk6IElXb3JrQm9vaztcclxuICAgIGNyZWF0ZUJ1aWxkZXI8VD4odmFsdWVzOiBUW10pOiBXb3JrU2hlZXRCdWlsZGVyPFQ+O1xyXG4gICAgc2F2ZUFzKG5hbWU6IHN0cmluZywgd29ya2Jvb2s6IElXb3JrQm9vayk7XHJcbn1cclxuXHJcbmNsYXNzIEV4Y2VsQ29udmVydGVyIGltcGxlbWVudHMgSUV4Y2VsQ29udmVydGVyIHtcclxuXHJcbiAgICBzdGF0aWMgJGluamVjdCA9IFsnc2F2ZUFzJywgJ1hMU1gnLCAnbW9tZW50JywgJ2N1cnJlbmN5JywgJ2FjY291bnRpbmcnXTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9zYXZlQXM6IGFueSwgcHJpdmF0ZSB4bHN4OiBhbnksIHByaXZhdGUgbW9tZW50OiBhbnksIHByaXZhdGUgY3VycmVuY3k6IGFueSwgcHJpdmF0ZSBhY2NvdW50aW5nOiBhbnkpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlKCk6IElXb3JrQm9vayB7XHJcbiAgICAgICAgdmFyIHdiID0gbmV3IFdvcmtCb29rKHRoaXMueGxzeCk7XHJcbiAgICAgICAgcmV0dXJuIHdiO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUJ1aWxkZXI8VD4odmFsdWVzOiBUW10pOiBXb3JrU2hlZXRCdWlsZGVyPFQ+IHtcclxuICAgICAgICBjb25zdCBidWlsZGVyID0gbmV3IFdvcmtTaGVldEJ1aWxkZXIodGhpcy54bHN4LCB0aGlzLm1vbWVudCwgdGhpcy5jdXJyZW5jeSwgdGhpcy5hY2NvdW50aW5nLCB2YWx1ZXMpO1xyXG4gICAgICAgIHJldHVybiBidWlsZGVyO1xyXG4gICAgfVxyXG5cclxuICAgIHNhdmVBcyhuYW1lOiBzdHJpbmcsIHdvcmtib29rOiBJV29ya0Jvb2spIHtcclxuICAgICAgICB2YXIgZW5hYmxlTGVnYWN5U2FmYXJpU3VwcG9ydCA9IHRydWU7XHJcbiAgICAgICAgdmFyIHdib3V0ID0gdGhpcy54bHN4LndyaXRlKHdvcmtib29rLCB7IGJvb2tUeXBlOiAneGxzeCcsIGJvb2tTU1Q6IGVuYWJsZUxlZ2FjeVNhZmFyaVN1cHBvcnQsIHR5cGU6ICdiaW5hcnknIH0pO1xyXG4gICAgICAgIHZhciBidWZmZXIgPSB0aGlzLmNvbnZlcnRUb0JpbmFyeSh3Ym91dCk7XHJcbiAgICAgICAgdGhpcy5fc2F2ZUFzKG5ldyBCbG9iKFtidWZmZXJdLCB7IHR5cGU6IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIgfSksIGAke25hbWV9Lnhsc3hgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNvbnZlcnRUb0JpbmFyeSh3b3JrYm9vaykge1xyXG4gICAgICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIod29ya2Jvb2subGVuZ3RoKTtcclxuICAgICAgICB2YXIgdmlldyA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IHdvcmtib29rLmxlbmd0aDsgKytpKVxyXG4gICAgICAgICAgICB2aWV3W2ldID0gd29ya2Jvb2suY2hhckNvZGVBdChpKSAmIDB4RkY7XHJcbiAgICAgICAgcmV0dXJuIGJ1ZmZlcjtcclxuICAgIH1cclxufVxyXG5cclxuQW5ndWxhci5tb2R1bGUoXCJhbmd1bGFyLWV4Y2VsXCIpLnNlcnZpY2UoJ2V4Y2VsQ29udmVydGVyJywgRXhjZWxDb252ZXJ0ZXIpOyJdfQ==